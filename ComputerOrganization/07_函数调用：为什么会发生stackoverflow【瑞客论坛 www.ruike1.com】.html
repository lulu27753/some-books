<html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover"> <meta name="format-detection" content="telephone=no"> <title>07 | å‡½æ•°è°ƒç”¨ï¼šä¸ºä»€ä¹ˆä¼šå‘ç”Ÿstack overflowï¼Ÿ</title>         <style type="text/css"> html { color: #333; -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; text-rendering: optimizelegibility; font-family: Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif } html.borderbox *,html.borderbox :after,html.borderbox :before { box-sizing: border-box } article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul { margin: 0; padding: 0 } article,aside,details,figcaption,figure,footer,header,menu,nav,section { display: block } audio,canvas,video { display: inline-block } body,button,input,select,textarea { font: 300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif } button::-moz-focus-inner,input::-moz-focus-inner { padding: 0; border: 0 } table { border-collapse: collapse; border-spacing: 0 } fieldset,img { border: 0 } blockquote { position: relative; color: #999; font-weight: 400; border-left: 1px solid #1abc9c; padding-left: 1em; margin: 1em 3em 1em 2em } @media only screen and (max-width: 640px) { blockquote { margin:1em 0 } } abbr,acronym { border-bottom: 1px dotted; font-variant: normal } abbr { cursor: help } del { text-decoration: line-through } address,caption,cite,code,dfn,em,th,var { font-style: normal; font-weight: 400 } ol,ul { list-style: none } caption,th { text-align: left } q:after,q:before { content: "" } sub,sup { font-size: 75%; line-height: 0; position: relative } :root sub,:root sup { vertical-align: baseline } sup { top: -.5em } sub { bottom: -.25em } a { color: #1abc9c } a:hover { text-decoration: underline } .typo a { border-bottom: 1px solid #1abc9c } .typo a:hover { border-bottom-color: #555; color: #555 } .typo a:hover,a,ins { text-decoration: none } .typo-u,u { text-decoration: underline } mark { background: #fffdd1; border-bottom: 1px solid #ffedce; padding: 2px; margin: 0 5px } code,pre,pre tt { font-family: Courier,Courier New,monospace } pre { background: hsla(0,0%,97%,.7); border: 1px solid #ddd; padding: 1em 1.5em; display: block; -webkit-overflow-scrolling: touch } hr { border: none; border-bottom: 1px solid #cfcfcf; margin-bottom: .8em; height: 10px } .typo-small,figcaption,small { font-size: .9em; color: #888 } b,strong { font-weight: 700; color: #000 } [draggable] { cursor: move } .clearfix:after,.clearfix:before { content: ""; display: table } .clearfix:after { clear: both } .clearfix { zoom:1} .textwrap,.textwrap td,.textwrap th { word-wrap: break-word; word-break: break-all } .textwrap-table { table-layout: fixed } .serif { font-family: Palatino,Optima,Georgia,serif } .typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote { margin-bottom: 1rem } h1,h2,h3,h4,h5,h6 { font-family: PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif; color: #000; line-height: 1.35 } .typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6 { margin-top: 1.2em; margin-bottom: .6em; line-height: 1.35 } .typo-h1,.typo h1 { font-size: 2em } .typo-h2,.typo h2 { font-size: 1.8em } .typo-h3,.typo h3 { font-size: 1.6em } .typo-h4,.typo h4 { font-size: 1.4em } .typo-h5,.typo-h6,.typo h5,.typo h6 { font-size: 1.2em } .typo-ul,.typo ul { margin-left: 1.3em; list-style: disc } .typo-ol,.typo ol { list-style: decimal; margin-left: 1.9em } .typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul { margin-bottom: .8em; margin-left: 2em } .typo-ol ul,.typo-ul ul,.typo li ul { list-style: circle } .typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th { border: 1px solid #ddd; padding: .5em 1em; color: #666 } .typo-table th,.typo table th { background: #fbfbfb } .typo-table thead th,.typo table thead th { background: hsla(0,0%,95%,.7) } .typo table caption { border-bottom: none } .typo-input,.typo-textarea { -webkit-appearance: none; border-radius: 0 } .typo-em,.typo em,caption,legend { color: #000; font-weight: inherit } .typo-em { position: relative } .typo-em:after { position: absolute; top: .65em; left: 0; width: 100%; overflow: hidden; white-space: nowrap; content: "\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB" } .typo img { max-width: 100% } .common-content { font-weight: 400; color: #353535; line-height: 1.75rem; white-space: normal; word-break: normal; font-size: 1rem } .common-content img { display: block; max-width: 100%; background-color: #eee } .common-content audio,.common-content video { width: 100%; background-color: #eee } .common-content center,.common-content font { margin-top: 1rem; display: inline-block } .common-content center { width: 100% } .common-content pre { margin-top: 1rem; padding-left: 0; padding-right: 0; position: relative; overflow: hidden } .common-content pre code { font-size: .8rem; font-family: Consolas,Liberation Mono,Menlo,monospace,Courier; display: block; width: 100%; box-sizing: border-box; padding-left: 1rem; padding-right: 1rem; overflow-x: auto } .common-content hr { border: none; margin-top: 1.5rem; margin-bottom: 1.5rem; border-top: 1px solid #f5f5f5; height: 1px; background: none } .common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong { font-weight: 700 } .common-content h1,.common-content h2 { font-size: 1.125rem; margin-bottom: .45rem } .common-content h3,.common-content h4,.common-content h5 { font-size: 1rem; margin-bottom: .45rem } .common-content p { font-weight: 400; color: #353535; margin-top: .15rem } .common-content .orange { color: #ff5a05 } .common-content .reference { font-size: 1rem; color: #888 } .custom-rich-content h1 { margin-top: 0; font-weight: 400; font-size: 15.25px; border-bottom: 1px solid #eee; line-height: 2.8 } .custom-rich-content li,.custom-rich-content p { font-size: 14px; color: #888; line-height: 1.6 } table.hljs-ln { margin-bottom: 0; border-spacing: 0; border-collapse: collapse } table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr { box-sizing: border-box } table.hljs-ln td { padding: 0; border: 0 } table.hljs-ln td.hljs-ln-numbers { min-width: 15px; color: rgba(27,31,35,.3); text-align: right; white-space: nowrap; cursor: pointer; user-select: none } table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers { font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace; font-size: 12px; line-height: 20px; vertical-align: top } table.hljs-ln td.hljs-ln-code { position: relative; padding-right: 10px; padding-left: 10px; overflow: visible; color: #24292e; word-wrap: normal; white-space: pre } video::-webkit-media-controls { overflow: hidden!important } video::-webkit-media-controls-enclosure { width: calc(100% + 32px); margin-left: auto } .button-cancel { color: #888; border: 1px solid #888; border-radius: 3px; margin-right: 12px } .button-cancel,.button-primary { -ms-flex-positive: 1; flex-grow: 1; height: 35px; display: inline-block; font-size: 15px; text-align: center; line-height: 36px } .button-primary { color: #fff; background-color: #ff5a05; border-radius: 3px } @font-face { font-family: iconfont; src: url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot); src: url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.woff) format("woff"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.ttf) format("truetype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.svg#iconfont) format("svg") } @font-face { font-family: player-font; src: url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot); src: url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.woff) format("woff"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.ttf) format("truetype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.svg#player-font) format("svg") } .iconfont { font-family: iconfont!important; font-size: 16px; font-style: normal; -webkit-font-smoothing: antialiased; -webkit-text-stroke-width: .2px; -moz-osx-font-smoothing: grayscale } html { background: #fff; min-height: 100%; -webkit-tap-highlight-color: rgba(0,0,0,0) } body { width: 100% } body.fixed { overflow: hidden; position: fixed; width: 100vw; height: 100vh } i { font-style: normal } a { word-wrap: break-word; -webkit-tap-highlight-color: rgba(0,0,0,0) } a:hover { text-decoration: none } .fade-enter-active,.fade-leave-active { transition: opacity .3s } .fade-enter,.fade-leave-to { opacity: 0 } .MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG { outline: 0 } .ios-app-switch .js-audit { display: none } ._loading_wrap_ { position: fixed; width: 100vw; height: 100vh; top: 50%; left: 50%; transform: translate(-50%,-50%); z-index: 999 } ._loading_div_class_,._loading_wrap_ { display: -ms-flexbox; display: flex; -ms-flex-pack: center; justify-content: center; -ms-flex-align: center; align-items: center } ._loading_div_class_ { word-wrap: break-word; padding: .5rem .75rem; text-align: center; z-index: 9999; font-size: .6rem; max-width: 60%; color: #fff; border-radius: .25rem; -ms-flex-direction: column; flex-direction: column } ._loading_div_class_ .message { color: #353535; font-size: 16px; line-height: 3 } .spinner { animation: circle-rotator 1.4s linear infinite } .spinner * { line-height: 0; box-sizing: border-box } @keyframes circle-rotator { 0% { transform: rotate(0deg) } to { transform: rotate(270deg) } } .path { stroke-dasharray: 187; stroke-dashoffset: 0; transform-origin: center; animation: circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite } @keyframes circle-colors { 0% { stroke: #ff5a05 } to { stroke: #ff5a05 } } @keyframes circle-dash { 0% { stroke-dashoffset: 187 } 50% { stroke-dashoffset: 46.75; transform: rotate(135deg) } to { stroke-dashoffset: 187; transform: rotate(450deg) } } .confirm-box-wrapper,.confirm-box-wrapper .mask { position: absolute; top: 0; left: 0; right: 0; bottom: 0 } .confirm-box-wrapper .mask { background: rgba(0,0,0,.6) } .confirm-box-wrapper .confirm-box { position: fixed; top: 50%; left: 50%; width: 267px; background: #fff; transform: translate(-50%,-50%); border-radius: 7px } .confirm-box-wrapper .confirm-box .head { margin: 0 18px; font-size: 18px; text-align: center; line-height: 65px; border-bottom: 1px solid #d9d9d9 } .confirm-box-wrapper .confirm-box .body { padding: 18px; padding-bottom: 0; color: #353535; font-size: 12.5px; max-height: 150px; overflow: auto } .confirm-box-wrapper .confirm-box .foot { display: -ms-flexbox; display: flex; -ms-flex-direction: row; flex-direction: row; padding: 18px } .confirm-box-wrapper .confirm-box .foot .button-cancel { border: 1px solid #d9d9d9 } .hljs { display: block; overflow-x: auto; padding: .5em; color: #333; background: #f8f8f8 } .hljs-comment,.hljs-quote { color: #998; font-style: italic } .hljs-keyword,.hljs-selector-tag,.hljs-subst { color: #333; font-weight: 700 } .hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable { color: teal } .hljs-doctag,.hljs-string { color: #d14 } .hljs-section,.hljs-selector-id,.hljs-title { color: #900; font-weight: 700 } .hljs-subst { font-weight: 400 } .hljs-class .hljs-title,.hljs-type { color: #458; font-weight: 700 } .hljs-attribute,.hljs-name,.hljs-tag { color: navy; font-weight: 400 } .hljs-link,.hljs-regexp { color: #009926 } .hljs-bullet,.hljs-symbol { color: #990073 } .hljs-built_in,.hljs-builtin-name { color: #0086b3 } .hljs-meta { color: #999; font-weight: 700 } .hljs-deletion { background: #fdd } .hljs-addition { background: #dfd } .hljs-emphasis { font-style: italic } .hljs-strong { font-weight: 700 } .button-cancel[data-v-87ffcada] { color: #888; border: 1px solid #888; border-radius: 3px; margin-right: 12px } .button-cancel[data-v-87ffcada],.button-primary[data-v-87ffcada] { -webkit-box-flex: 1; -ms-flex-positive: 1; flex-grow: 1; height: 35px; display: inline-block; font-size: 15px; text-align: center; line-height: 36px } .button-primary[data-v-87ffcada] { color: #fff; background-color: #ff5a05; border-radius: 3px } .pd[data-v-87ffcada] { padding-left: 1.375rem; padding-right: 1.375rem } .article[data-v-87ffcada] { max-width: 70rem; margin: 0 auto } .article .article-unavailable[data-v-87ffcada] { color: #fa8919; font-size: 15px; font-weight: 600; line-height: 24px; border-radius: 5px; padding: 12px; background-color: #f6f7fb; margin-top: 20px } .article .article-unavailable .iconfont[data-v-87ffcada] { font-size: 12px } .article .main[data-v-87ffcada] { padding: 1.25rem 0; margin-bottom: 52px } .article-title[data-v-87ffcada] { color: #353535; font-weight: bold; line-height: 1.65rem; font-size: 1.34375rem } .article-info[data-v-87ffcada] { color: #888; font-size: .9375rem; margin-top: 1.0625rem } .article-content[data-v-87ffcada] { margin-top: 1.0625rem } .article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button { display: none } .copyright[data-v-87ffcada] { color: #b2b2b2; padding-bottom: 20px; margin-top: 20px; font-size: 13px } .audio-player[data-v-87ffcada] { width: 100%; margin: 20px 0 } .to-comment[data-v-87ffcada] { overflow: hidden; padding-top: 10px; margin-bottom: -30px } .to-comment a.button-primary[data-v-87ffcada] { float: right; height: 20px; font-size: 12px; line-height: 20px; padding: 4px 8px; cursor: pointer } .article-comments[data-v-87ffcada] { margin-top: 2rem } .article-comments h2[data-v-87ffcada] { text-align: center; color: #888; position: relative; z-index: 1; margin-bottom: 1rem } .article-comments h2[data-v-87ffcada]:before { border-top: 1px dotted #888; content: ""; position: absolute; top: 56%; left: 0; width: 100%; z-index: -1 } .article-comments h2 span[data-v-87ffcada] { font-size: 15.25px; font-weight: 400; padding: 0 1rem; background: #fff; display: inline-block } .article-sub-bottom[data-v-87ffcada] { z-index: 10; cursor: pointer } .switch-btns[data-v-87ffcada] { height: 76px; cursor: pointer; padding-top: 24px; padding-bottom: 24px; border-bottom: 10px solid #f6f7fb; position: relative } .switch-btns[data-v-87ffcada]:before { content: " "; height: 1px; background: #e8e8e8; position: absolute; top: 0; left: 0; -webkit-box-sizing: border-box; box-sizing: border-box; left: 1.375rem; right: 1.375rem } .switch-btns .btn[data-v-87ffcada] { height: 38px; display: -webkit-box; display: -ms-flexbox; display: flex; -webkit-box-align: center; -ms-flex-align: center; align-items: center } .switch-btns .btn .tag[data-v-87ffcada] { -webkit-box-flex: 0; -ms-flex: 0 0 62px; flex: 0 0 62px; text-align: center; color: #888; font-size: 14px; border-radius: 10px; height: 22px; line-height: 22px; background: #f6f7fb; font-weight: 400 } .switch-btns .btn .txt[data-v-87ffcada] { margin-left: 10px; -webkit-box-flex: 1; -ms-flex: 1 1 auto; flex: 1 1 auto; color: #888; font-size: 15px; height: 22px; line-height: 22px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-weight: 400 } @media (max-width: 769px) { .article .breadcrumb[data-v-87ffcada] { padding-top:10px; padding-bottom: 10px } } .comment-item { list-style-position: inside; width: 100%; display: -webkit-box; display: -ms-flexbox; display: flex; -webkit-box-orient: horizontal; -webkit-box-direction: normal; -ms-flex-direction: row; flex-direction: row; margin-bottom: 1rem } .comment-item a { border-bottom: none } .comment-item .avatar { width: 2.625rem; height: 2.625rem; -ms-flex-negative: 0; flex-shrink: 0; border-radius: 50% } .comment-item .info { margin-left: .5rem; -webkit-box-flex: 1; -ms-flex-positive: 1; flex-grow: 1 } .comment-item .info .hd { width: 100%; display: -webkit-box; display: -ms-flexbox; display: flex; -webkit-box-orient: horizontal; -webkit-box-direction: normal; -ms-flex-direction: row; flex-direction: row; -webkit-box-pack: justify; -ms-flex-pack: justify; justify-content: space-between; -webkit-box-align: center; -ms-flex-align: center; align-items: center } .comment-item .info .hd .username { color: #888; font-size: 15.25px; font-weight: 400; line-height: 1.2 } .comment-item .info .hd .control { display: -webkit-box; display: -ms-flexbox; display: flex; -webkit-box-orient: horizontal; -webkit-box-direction: normal; -ms-flex-direction: row; flex-direction: row; -webkit-box-align: center; -ms-flex-align: center; align-items: center } .comment-item .info .hd .control .btn-share { color: #888; font-size: .75rem; margin-right: 1rem } .comment-item .info .hd .control .btn-praise { display: -webkit-box; display: -ms-flexbox; display: flex; -webkit-box-orient: horizontal; -webkit-box-direction: normal; -ms-flex-direction: row; flex-direction: row; -webkit-box-align: center; -ms-flex-align: center; align-items: center; font-size: 15.25px; text-decoration: none } .comment-item .info .hd .control .btn-praise i { color: #888; display: inline-block; font-size: .75rem; margin-right: .3rem; margin-top: -.01rem } .comment-item .info .hd .control .btn-praise i.on,.comment-item .info .hd .control .btn-praise span { color: #ff5a05 } .comment-item .info .bd { color: #353535; font-size: 15.25px; font-weight: 400; white-space: normal; word-break: break-all; line-height: 1.6 } .comment-item .info .time { color: #888; font-size: 9px; line-height: 1 } .comment-item .info .reply .reply-hd { font-size: 15.25px } .comment-item .info .reply .reply-hd span { margin-left: -12px; color: #888; font-weight: 400 } .comment-item .info .reply .reply-hd i { color: #ff5a05; font-size: 15.25px } .comment-item .info .reply .reply-content { background: #f6f7fb; padding: 18px; border-radius: 10px; color: #353535; font-size: 15.25px; font-weight: 400; white-space: normal; word-break: break-all } .comment-item .info .reply .reply-time { color: #888; font-size: 9px } </style> </head> <body> <div id="app"> <div data-v-87ffcada="" class="article" id="watermark"> <div data-v-87ffcada="" class="main main-app"> <h1 data-v-87ffcada="" class="article-title pd"> 07 | å‡½æ•°è°ƒç”¨ï¼šä¸ºä»€ä¹ˆä¼šå‘ç”Ÿstack overflowï¼Ÿ </h1> <hr> <div data-v-87ffcada="" class="article-content typo common-content pd"> <img data-v-87ffcada="" src="https://static001.geekbang.org/resource/image/5e/2c/5e068ce407b89cbc379b7e5fde2b7f2c.jpg"> <div data-v-87ffcada="" id="article-content" class=""> <div class="text"> <p>åœ¨å¼€å‘è½¯ä»¶çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°é”™è¯¯ï¼Œå¦‚æœä½ ç”¨Googleæœè¿‡å‡ºé”™ä¿¡æ¯ï¼Œé‚£ä½ å¤šå°‘åº”è¯¥éƒ½è®¿é—®è¿‡<a href="https://stackoverflow.com/">Stack Overflow</a>è¿™ä¸ªç½‘ç«™ã€‚ä½œä¸ºå…¨çƒæœ€å¤§çš„ç¨‹åºå‘˜é—®ç­”ç½‘ç«™ï¼ŒStack Overflowçš„åå­—æ¥è‡ªäºä¸€ä¸ªå¸¸è§çš„æŠ¥é”™ï¼Œå°±æ˜¯æ ˆæº¢å‡ºï¼ˆstack overflowï¼‰ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±ä»ç¨‹åºçš„å‡½æ•°è°ƒç”¨å¼€å§‹ï¼Œè®²è®²å‡½æ•°é—´çš„ç›¸äº’è°ƒç”¨ï¼Œåœ¨è®¡ç®—æœºæŒ‡ä»¤å±‚é¢æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œä»¥åŠä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿæ ˆæº¢å‡ºè¿™ä¸ªé”™è¯¯ã€‚</p><h2>ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ç¨‹åºæ ˆï¼Ÿ</h2><p>å’Œå‰é¢å‡ è®²ä¸€æ ·ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä»ä¸€ä¸ªéå¸¸ç®€å•çš„Cç¨‹åºfunction_example.cçœ‹èµ·ã€‚</p><pre><code>// function_example.c
#include &lt;stdio.h&gt;
int static add(int a, int b)
{
    return a+b;
}


int main()
{
    int x = 5;
    int y = 10;
    int u = add(x, y);
}
</code></pre><p>è¿™ä¸ªç¨‹åºå®šä¹‰äº†ä¸€ä¸ªç®€å•çš„å‡½æ•°addï¼Œæ¥å—ä¸¤ä¸ªå‚æ•°aå’Œbï¼Œè¿”å›å€¼å°±æ˜¯a+bã€‚è€Œmainå‡½æ•°é‡Œåˆ™å®šä¹‰äº†ä¸¤ä¸ªå˜é‡xå’Œyï¼Œç„¶åé€šè¿‡è°ƒç”¨è¿™ä¸ªaddå‡½æ•°ï¼Œæ¥è®¡ç®—u=x+yï¼Œæœ€åæŠŠuçš„æ•°å€¼æ‰“å°å‡ºæ¥ã€‚</p><pre><code>$ gcc -g -c function_example.c
$ objdump -d -M intel -S function_example.o
</code></pre><p>æˆ‘ä»¬æŠŠè¿™ä¸ªç¨‹åºç¼–è¯‘ä¹‹åï¼Œobjdumpå‡ºæ¥ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹å¯¹åº”çš„æ±‡ç¼–ä»£ç ã€‚</p><pre><code>int static add(int a, int b)
{
   0:   55                      push   rbp
   1:   48 89 e5                mov    rbp,rsp
   4:   89 7d fc                mov    DWORD PTR [rbp-0x4],edi
   7:   89 75 f8                mov    DWORD PTR [rbp-0x8],esi
    return a+b;
   a:   8b 55 fc                mov    edx,DWORD PTR [rbp-0x4]
   d:   8b 45 f8                mov    eax,DWORD PTR [rbp-0x8]
  10:   01 d0                   add    eax,edx
}
  12:   5d                      pop    rbp
  13:   c3                      ret    
0000000000000014 &lt;main&gt;:
int main()
{
  14:   55                      push   rbp
  15:   48 89 e5                mov    rbp,rsp
  18:   48 83 ec 10             sub    rsp,0x10
    int x = 5;
  1c:   c7 45 fc 05 00 00 00    mov    DWORD PTR [rbp-0x4],0x5
    int y = 10;
  23:   c7 45 f8 0a 00 00 00    mov    DWORD PTR [rbp-0x8],0xa
    int u = add(x, y);
  2a:   8b 55 f8                mov    edx,DWORD PTR [rbp-0x8]
  2d:   8b 45 fc                mov    eax,DWORD PTR [rbp-0x4]
  30:   89 d6                   mov    esi,edx
  32:   89 c7                   mov    edi,eax
  34:   e8 c7 ff ff ff          call   0 &lt;add&gt;
  39:   89 45 f4                mov    DWORD PTR [rbp-0xc],eax
  3c:   b8 00 00 00 00          mov    eax,0x0
}
  41:   c9                      leave  
  42:   c3                      ret    
</code></pre><p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œåœ¨è¿™æ®µä»£ç é‡Œï¼Œmainå‡½æ•°å’Œä¸Šä¸€èŠ‚æˆ‘ä»¬è®²çš„çš„ç¨‹åºæ‰§è¡ŒåŒºåˆ«å¹¶ä¸å¤§ï¼Œå®ƒä¸»è¦æ˜¯æŠŠjumpæŒ‡ä»¤æ¢æˆäº†å‡½æ•°è°ƒç”¨çš„callæŒ‡ä»¤ã€‚callæŒ‡ä»¤åé¢è·Ÿç€çš„ï¼Œä»ç„¶æ˜¯è·³è½¬åçš„ç¨‹åºåœ°å€ã€‚</p><p>è¿™äº›ä½ ç†è§£èµ·æ¥åº”è¯¥ä¸æˆé—®é¢˜ã€‚æˆ‘ä»¬ä¸‹é¢æ¥çœ‹ä¸€ä¸ªæœ‰æ„æ€çš„éƒ¨åˆ†ã€‚</p><!-- [[[read_end]]] --><p>æˆ‘ä»¬æ¥çœ‹addå‡½æ•°ã€‚å¯ä»¥çœ‹åˆ°ï¼Œaddå‡½æ•°ç¼–è¯‘ä¹‹åï¼Œä»£ç å…ˆæ‰§è¡Œäº†ä¸€æ¡pushæŒ‡ä»¤å’Œä¸€æ¡movæŒ‡ä»¤ï¼›åœ¨å‡½æ•°æ‰§è¡Œç»“æŸçš„æ—¶å€™ï¼Œåˆæ‰§è¡Œäº†ä¸€æ¡popå’Œä¸€æ¡retæŒ‡ä»¤ã€‚è¿™å››æ¡æŒ‡ä»¤çš„æ‰§è¡Œï¼Œå…¶å®å°±æ˜¯åœ¨è¿›è¡Œæˆ‘ä»¬æ¥ä¸‹æ¥è¦è®²<strong>å‹æ ˆ</strong>ï¼ˆPushï¼‰å’Œ<strong>å‡ºæ ˆ</strong>ï¼ˆPopï¼‰æ“ä½œã€‚</p><p>ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œå‡½æ•°è°ƒç”¨å’Œä¸Šä¸€èŠ‚æˆ‘ä»¬è®²çš„ifâ€¦elseå’Œfor/whileå¾ªç¯æœ‰ç‚¹åƒã€‚å®ƒä»¬ä¸¤ä¸ªéƒ½æ˜¯åœ¨åŸæ¥é¡ºåºæ‰§è¡Œçš„æŒ‡ä»¤è¿‡ç¨‹é‡Œï¼Œæ‰§è¡Œäº†ä¸€ä¸ªå†…å­˜åœ°å€çš„è·³è½¬æŒ‡ä»¤ï¼Œè®©æŒ‡ä»¤ä»åŸæ¥é¡ºåºæ‰§è¡Œçš„è¿‡ç¨‹é‡Œè·³å¼€ï¼Œä»æ–°çš„è·³è½¬åçš„ä½ç½®å¼€å§‹æ‰§è¡Œã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ä¸¤ä¸ªè·³è½¬æœ‰ä¸ªåŒºåˆ«ï¼Œifâ€¦elseå’Œfor/whileçš„è·³è½¬ï¼Œæ˜¯è·³è½¬èµ°äº†å°±ä¸å†å›æ¥äº†ï¼Œå°±åœ¨è·³è½¬åçš„æ–°åœ°å€å¼€å§‹é¡ºåºåœ°æ‰§è¡ŒæŒ‡ä»¤ï¼Œå°±å¥½åƒå¾å¿—æ‘©åœ¨ã€Šå†åˆ«åº·æ¡¥ã€‹é‡Œé¢å†™çš„ï¼šâ€œæˆ‘æŒ¥ä¸€æŒ¥è¡£è¢–ï¼Œä¸å¸¦èµ°ä¸€ç‰‡äº‘å½©â€ï¼Œç»§ç»­è¿›è¡Œæ–°çš„ç”Ÿæ´»äº†ã€‚è€Œå‡½æ•°è°ƒç”¨çš„è·³è½¬ï¼Œåœ¨å¯¹åº”å‡½æ•°çš„æŒ‡ä»¤æ‰§è¡Œå®Œäº†ä¹‹åï¼Œè¿˜è¦å†å›åˆ°å‡½æ•°è°ƒç”¨çš„åœ°æ–¹ï¼Œç»§ç»­æ‰§è¡Œcallä¹‹åçš„æŒ‡ä»¤ï¼Œå°±å¥½åƒè´ºçŸ¥ç« åœ¨ã€Šå›ä¹¡å¶ä¹¦ã€‹é‡Œé¢å†™çš„é‚£æ ·ï¼šâ€œå°‘å°ç¦»å®¶è€å¤§å›ï¼Œä¹¡éŸ³æœªæ”¹é¬“æ¯›è¡°â€ï¼Œä¸ç®¡èµ°å¤šè¿œï¼Œæœ€ç»ˆè¿˜æ˜¯è¦å›æ¥ã€‚</p><p>é‚£æˆ‘ä»¬æœ‰æ²¡æœ‰ä¸€ä¸ªå¯ä»¥ä¸è·³è½¬å›åˆ°åŸæ¥å¼€å§‹çš„åœ°æ–¹ï¼Œæ¥å®ç°å‡½æ•°çš„è°ƒç”¨å‘¢ï¼Ÿç›´è§‰ä¸Šä¼¼ä¹æœ‰è¿™ä¹ˆä¸€ä¸ªè§£å†³åŠæ³•ã€‚ä½ å¯ä»¥æŠŠè°ƒç”¨çš„å‡½æ•°æŒ‡ä»¤ï¼Œç›´æ¥æ’å…¥åœ¨è°ƒç”¨å‡½æ•°çš„åœ°æ–¹ï¼Œæ›¿æ¢æ‰å¯¹åº”çš„callæŒ‡ä»¤ï¼Œç„¶ååœ¨ç¼–è¯‘å™¨ç¼–è¯‘ä»£ç çš„æ—¶å€™ï¼Œç›´æ¥å°±æŠŠå‡½æ•°è°ƒç”¨å˜æˆå¯¹åº”çš„æŒ‡ä»¤æ›¿æ¢æ‰ã€‚</p><p>ä¸è¿‡ï¼Œä»”ç»†ç¢ç£¨ä¸€ä¸‹ï¼Œä½ ä¼šå‘ç°è¿™ä¸ªæ–¹æ³•æœ‰äº›é—®é¢˜ã€‚å¦‚æœå‡½æ•°Aè°ƒç”¨äº†å‡½æ•°Bï¼Œç„¶åå‡½æ•°Bå†è°ƒç”¨å‡½æ•°Aï¼Œæˆ‘ä»¬å°±å¾—é¢ä¸´åœ¨Aé‡Œé¢æ’å…¥Bçš„æŒ‡ä»¤ï¼Œç„¶ååœ¨Bé‡Œé¢æ’å…¥Açš„æŒ‡ä»¤ï¼Œè¿™æ ·å°±ä¼šäº§ç”Ÿæ— ç©·æ— å°½åœ°æ›¿æ¢ã€‚å°±å¥½åƒä¸¤é¢é•œå­é¢å¯¹é¢æ”¾åœ¨ä¸€å—å„¿ï¼Œä»»ä½•ä¸€é¢é•œå­é‡Œé¢éƒ½ä¼šçœ‹åˆ°æ— ç©·å¤šé¢é•œå­ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/0b/06/0b4d9f07a7d15e5e25908bbf1532e706.jpg" alt=""></p><center>Infinite Mirror Effectï¼Œå¦‚æœå‡½æ•°Aè°ƒç”¨Bï¼ŒBå†è°ƒç”¨Aï¼Œé‚£ä¹ˆä»£ç ä¼šæ— é™å±•å¼€ï¼Œ<a href="https://commons.wikimedia.org/w/index.php?curid=40716759">å›¾ç‰‡æ¥æº</a></center><p>çœ‹æ¥ï¼ŒæŠŠè¢«è°ƒç”¨å‡½æ•°çš„æŒ‡ä»¤ç›´æ¥æ’å…¥åœ¨è°ƒç”¨å¤„çš„æ–¹æ³•è¡Œä¸é€šã€‚é‚£æˆ‘ä»¬å°±æ¢ä¸€ä¸ªæ€è·¯ï¼Œèƒ½ä¸èƒ½æŠŠåé¢è¦è·³å›æ¥æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ç»™è®°å½•ä¸‹æ¥å‘¢ï¼Ÿå°±åƒå‰é¢è®²PCå¯„å­˜å™¨ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä¸“é—¨è®¾ç«‹ä¸€ä¸ªâ€œç¨‹åºè°ƒç”¨å¯„å­˜å™¨â€ï¼Œæ¥å­˜å‚¨æ¥ä¸‹æ¥è¦è·³è½¬å›æ¥æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ã€‚ç­‰åˆ°å‡½æ•°è°ƒç”¨ç»“æŸï¼Œä»è¿™ä¸ªå¯„å­˜å™¨é‡Œå–å‡ºåœ°å€ï¼Œå†è·³è½¬åˆ°è¿™ä¸ªè®°å½•çš„åœ°å€ï¼Œç»§ç»­æ‰§è¡Œå°±å¥½äº†ã€‚</p><p>ä½†æ˜¯åœ¨å¤šå±‚å‡½æ•°è°ƒç”¨é‡Œï¼Œç®€å•åªè®°å½•ä¸€ä¸ªåœ°å€ä¹Ÿæ˜¯ä¸å¤Ÿçš„ã€‚æˆ‘ä»¬åœ¨è°ƒç”¨å‡½æ•°Aä¹‹åï¼ŒAè¿˜å¯ä»¥è°ƒç”¨å‡½æ•°Bï¼ŒBè¿˜èƒ½è°ƒç”¨å‡½æ•°Cã€‚è¿™ä¸€å±‚åˆä¸€å±‚çš„è°ƒç”¨å¹¶æ²¡æœ‰æ•°é‡ä¸Šçš„é™åˆ¶ã€‚åœ¨æ‰€æœ‰å‡½æ•°è°ƒç”¨è¿”å›ä¹‹å‰ï¼Œæ¯ä¸€æ¬¡è°ƒç”¨çš„è¿”å›åœ°å€éƒ½è¦è®°å½•ä¸‹æ¥ï¼Œä½†æ˜¯æˆ‘ä»¬CPUé‡Œçš„å¯„å­˜å™¨æ•°é‡å¹¶ä¸å¤šã€‚åƒæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨çš„Intel i7 CPUåªæœ‰16ä¸ª64ä½å¯„å­˜å™¨ï¼Œè°ƒç”¨çš„å±‚æ•°ä¸€å¤šå°±å­˜ä¸ä¸‹äº†ã€‚</p><p>æœ€ç»ˆï¼Œè®¡ç®—æœºç§‘å­¦å®¶ä»¬æƒ³åˆ°äº†ä¸€ä¸ªæ¯”å•ç‹¬è®°å½•è·³è½¬å›æ¥çš„åœ°å€æ›´å®Œå–„çš„åŠæ³•ã€‚æˆ‘ä»¬åœ¨å†…å­˜é‡Œé¢å¼€è¾Ÿä¸€æ®µç©ºé—´ï¼Œç”¨æ ˆè¿™ä¸ª<strong>åè¿›å…ˆå‡º</strong>ï¼ˆLIFOï¼ŒLast In First Outï¼‰çš„æ•°æ®ç»“æ„ã€‚æ ˆå°±åƒä¸€ä¸ªä¹’ä¹“çƒæ¡¶ï¼Œæ¯æ¬¡ç¨‹åºè°ƒç”¨å‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½æŠŠè°ƒç”¨è¿”å›åçš„åœ°å€å†™åœ¨ä¸€ä¸ªä¹’ä¹“çƒä¸Šï¼Œç„¶åå¡è¿›è¿™ä¸ªçƒæ¡¶ã€‚è¿™ä¸ªæ“ä½œå…¶å®å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„<strong>å‹æ ˆ</strong>ã€‚å¦‚æœå‡½æ•°æ‰§è¡Œå®Œäº†ï¼Œæˆ‘ä»¬å°±ä»çƒæ¡¶é‡Œå–å‡ºæœ€ä¸Šé¢çš„é‚£ä¸ªä¹’ä¹“çƒï¼Œå¾ˆæ˜¾ç„¶ï¼Œè¿™å°±æ˜¯<strong>å‡ºæ ˆ</strong>ã€‚</p><p>æ‹¿åˆ°å‡ºæ ˆçš„ä¹’ä¹“çƒï¼Œæ‰¾åˆ°ä¸Šé¢çš„åœ°å€ï¼ŒæŠŠç¨‹åºè·³è½¬è¿‡å»ï¼Œå°±è¿”å›åˆ°äº†å‡½æ•°è°ƒç”¨åçš„ä¸‹ä¸€æ¡æŒ‡ä»¤äº†ã€‚å¦‚æœå‡½æ•°Aåœ¨æ‰§è¡Œå®Œæˆä¹‹å‰åˆè°ƒç”¨äº†å‡½æ•°Bï¼Œé‚£ä¹ˆåœ¨å–å‡ºä¹’ä¹“çƒä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¾€çƒæ¡¶é‡Œå¡ä¸€ä¸ªä¹’ä¹“çƒã€‚è€Œæˆ‘ä»¬ä»çƒæ¡¶æœ€ä¸Šé¢æ‹¿ä¹’ä¹“çƒçš„æ—¶å€™ï¼Œæ‹¿çš„ä¹Ÿä¸€å®šæ˜¯æœ€è¿‘ä¸€æ¬¡çš„ï¼Œä¹Ÿå°±æ˜¯æœ€ä¸‹é¢ä¸€å±‚çš„å‡½æ•°è°ƒç”¨å®Œæˆåçš„åœ°å€ã€‚ä¹’ä¹“çƒæ¡¶çš„åº•éƒ¨ï¼Œå°±æ˜¯<strong>æ ˆåº•</strong>ï¼Œæœ€ä¸Šé¢çš„ä¹’ä¹“çƒæ‰€åœ¨çš„ä½ç½®ï¼Œå°±æ˜¯<strong>æ ˆé¡¶</strong>ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/d0/be/d0c75219d3a528c920c2a593daaf77be.jpeg" alt=""></p><p>åœ¨çœŸå®çš„ç¨‹åºé‡Œï¼Œå‹æ ˆçš„ä¸åªæœ‰å‡½æ•°è°ƒç”¨å®Œæˆåçš„è¿”å›åœ°å€ã€‚æ¯”å¦‚å‡½æ•°Aåœ¨è°ƒç”¨Bçš„æ—¶å€™ï¼Œéœ€è¦ä¼ è¾“ä¸€äº›å‚æ•°æ•°æ®ï¼Œè¿™äº›å‚æ•°æ•°æ®åœ¨å¯„å­˜å™¨ä¸å¤Ÿç”¨çš„æ—¶å€™ä¹Ÿä¼šè¢«å‹å…¥æ ˆä¸­ã€‚æ•´ä¸ªå‡½æ•°Aæ‰€å ç”¨çš„æ‰€æœ‰å†…å­˜ç©ºé—´ï¼Œå°±æ˜¯å‡½æ•°Açš„<strong>æ ˆå¸§</strong>ï¼ˆStack Frameï¼‰ã€‚Frameåœ¨ä¸­æ–‡é‡Œä¹Ÿæœ‰â€œç›¸æ¡†â€çš„æ„æ€ï¼Œæ‰€ä»¥ï¼Œæ¯æ¬¡åˆ°è¿™é‡Œï¼Œæˆ‘éƒ½æœ‰ç§æ„Ÿè§‰ï¼Œæ•´ä¸ªå‡½æ•°Aæ‰€éœ€è¦çš„å†…å­˜ç©ºé—´å°±åƒæ˜¯è¢«è¿™ä¹ˆä¸€ä¸ªâ€œç›¸æ¡†â€ç»™æ¡†äº†èµ·æ¥ï¼Œæ”¾åœ¨äº†æ ˆé‡Œé¢ã€‚</p><p>è€Œå®é™…çš„ç¨‹åºæ ˆå¸ƒå±€ï¼Œé¡¶å’Œåº•ä¸æˆ‘ä»¬çš„ä¹’ä¹“çƒæ¡¶ç›¸æ¯”æ˜¯å€’è¿‡æ¥çš„ã€‚åº•åœ¨æœ€ä¸Šé¢ï¼Œé¡¶åœ¨æœ€ä¸‹é¢ï¼Œè¿™æ ·çš„å¸ƒå±€æ˜¯å› ä¸ºæ ˆåº•çš„å†…å­˜åœ°å€æ˜¯åœ¨ä¸€å¼€å§‹å°±å›ºå®šçš„ã€‚è€Œä¸€å±‚å±‚å‹æ ˆä¹‹åï¼Œæ ˆé¡¶çš„å†…å­˜åœ°å€æ˜¯åœ¨é€æ¸å˜å°è€Œä¸æ˜¯å˜å¤§ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/23/d1/2361ecf8cf08f07c83377376a31869d1.jpeg" alt=""></p><p>å¯¹åº”ä¸Šé¢å‡½æ•°addçš„æ±‡ç¼–ä»£ç ï¼Œæˆ‘ä»¬æ¥ä»”ç»†çœ‹çœ‹ï¼Œmainå‡½æ•°è°ƒç”¨addå‡½æ•°æ—¶ï¼Œaddå‡½æ•°å…¥å£åœ¨0ï½1è¡Œï¼Œaddå‡½æ•°ç»“æŸä¹‹ååœ¨12ï½13è¡Œã€‚</p><p>addå‡½æ•°çš„ç¬¬0è¡Œï¼Œpush rbpè¿™ä¸ªæŒ‡ä»¤ï¼Œå°±æ˜¯åœ¨è¿›è¡Œå‹æ ˆã€‚è¿™é‡Œçš„rbpåˆå«æ ˆå¸§æŒ‡é’ˆï¼ˆFrame Pointerï¼‰ï¼Œæ˜¯ä¸€ä¸ªå­˜æ”¾äº†å½“å‰æ ˆå¸§ä½ç½®çš„å¯„å­˜å™¨ã€‚push rbpå°±æŠŠä¹‹å‰è°ƒç”¨å‡½æ•°çš„è¿”å›åœ°å€ï¼Œå‹åˆ°æ ˆé¡¶ã€‚æ¥ç€ï¼Œç¬¬1è¡Œçš„ä¸€æ¡å‘½ä»¤mov rbp, rspé‡Œï¼Œåˆ™æ˜¯æŠŠrspè¿™ä¸ªæ ˆæŒ‡é’ˆï¼ˆStack Pointerï¼‰çš„å€¼å¤åˆ¶åˆ°rbpé‡Œï¼Œè€Œrspå§‹ç»ˆä¼šæŒ‡å‘æ ˆé¡¶ã€‚è¿™ä¸ªå‘½ä»¤æ„å‘³ç€ï¼Œrbpè¿™ä¸ªæ ˆå¸§æŒ‡é’ˆæŒ‡å‘çš„è¿”å›åœ°å€ï¼Œå˜æˆå½“å‰æœ€æ–°çš„æ ˆé¡¶ï¼Œä¹Ÿå°±æ˜¯addå‡½æ•°çš„è¿”å›åœ°å€äº†ã€‚</p><p>è€Œåœ¨å‡½æ•°addæ‰§è¡Œå®Œæˆä¹‹åï¼Œåˆä¼šåˆ†åˆ«è°ƒç”¨ç¬¬12è¡Œçš„pop rbpæ¥å°†å½“å‰çš„æ ˆé¡¶å‡ºæ ˆï¼Œç„¶åè°ƒç”¨ç¬¬13è¡Œçš„retæŒ‡ä»¤ï¼Œå°†ç¨‹åºçš„æ§åˆ¶æƒè¿”å›åˆ°å‡ºæ ˆåçš„æ ˆé¡¶ï¼Œä¹Ÿå°±æ˜¯mainå‡½æ•°çš„è¿”å›åœ°å€ã€‚</p><h2>å¦‚ä½•æ„é€ ä¸€ä¸ªstack  overflowï¼Ÿ</h2><p>é€šè¿‡å¼•å…¥æ ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæœ‰å¤šå°‘å±‚çš„å‡½æ•°è°ƒç”¨ï¼Œæˆ–è€…åœ¨å‡½æ•°Aé‡Œè°ƒç”¨å‡½æ•°Bï¼Œå†åœ¨å‡½æ•°Bé‡Œè°ƒç”¨Aï¼Œè¿™æ ·çš„é€’å½’è°ƒç”¨ï¼Œæˆ‘ä»¬éƒ½åªéœ€è¦é€šè¿‡ç»´æŒrbpå’Œrspï¼Œè¿™ä¸¤ä¸ªç»´æŠ¤æ ˆé¡¶æ‰€åœ¨åœ°å€çš„å¯„å­˜å™¨ï¼Œå°±èƒ½ç®¡ç†å¥½ä¸åŒå‡½æ•°ä¹‹é—´çš„è·³è½¬ã€‚ä¸è¿‡ï¼Œæ ˆçš„å¤§å°ä¹Ÿæ˜¯æœ‰é™çš„ã€‚å¦‚æœå‡½æ•°è°ƒç”¨å±‚æ•°å¤ªå¤šï¼Œæˆ‘ä»¬å¾€æ ˆé‡Œå‹å…¥å®ƒå­˜ä¸ä¸‹çš„å†…å®¹ï¼Œç¨‹åºåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å°±ä¼šé‡åˆ°æ ˆæº¢å‡ºçš„é”™è¯¯ï¼Œè¿™å°±æ˜¯å¤§åé¼é¼çš„â€œstack  overflowâ€ã€‚</p><p>è¦æ„é€ ä¸€ä¸ªæ ˆæº¢å‡ºçš„é”™è¯¯å¹¶ä¸å›°éš¾ï¼Œæœ€ç®€å•çš„åŠæ³•ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„Infiinite Mirror Effectçš„æ–¹å¼ï¼Œè®©å‡½æ•°Aè°ƒç”¨è‡ªå·±ï¼Œå¹¶ä¸”ä¸è®¾ä»»ä½•ç»ˆæ­¢æ¡ä»¶ã€‚è¿™æ ·ä¸€ä¸ªæ— é™é€’å½’çš„ç¨‹åºï¼Œåœ¨ä¸æ–­åœ°å‹æ ˆè¿‡ç¨‹ä¸­ï¼Œå°†æ•´ä¸ªæ ˆç©ºé—´å¡«æ»¡ï¼Œå¹¶æœ€ç»ˆé‡ä¸Šstack  overflowã€‚</p><pre><code>int a()
{
  return a();
}


int main()
{
  a();
  return 0;
}
</code></pre><p>é™¤äº†æ— é™é€’å½’ï¼Œé€’å½’å±‚æ•°è¿‡æ·±ï¼Œåœ¨æ ˆç©ºé—´é‡Œé¢åˆ›å»ºéå¸¸å å†…å­˜çš„å˜é‡ï¼ˆæ¯”å¦‚ä¸€ä¸ªå·¨å¤§çš„æ•°ç»„ï¼‰ï¼Œè¿™äº›æƒ…å†µéƒ½å¾ˆå¯èƒ½ç»™ä½ å¸¦æ¥stack  overflowã€‚ç›¸ä¿¡ä½ ç†è§£äº†æ ˆåœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹é‡Œé¢æ˜¯æ€ä¹ˆå›äº‹ï¼Œæœªæ¥åœ¨é‡åˆ°stackoverflowè¿™ä¸ªé”™è¯¯çš„æ—¶å€™ï¼Œä¸ä¼šå®Œå…¨æ²¡æœ‰æ–¹å‘äº†ã€‚</p><h2>å¦‚ä½•åˆ©ç”¨å‡½æ•°å†…è”è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Ÿ</h2><p>ä¸Šé¢æˆ‘ä»¬æåˆ°ä¸€ä¸ªæ–¹æ³•ï¼ŒæŠŠä¸€ä¸ªå®é™…è°ƒç”¨çš„å‡½æ•°äº§ç”Ÿçš„æŒ‡ä»¤ï¼Œç›´æ¥æ’å…¥åˆ°çš„ä½ç½®ï¼Œæ¥æ›¿æ¢å¯¹åº”çš„å‡½æ•°è°ƒç”¨æŒ‡ä»¤ã€‚å°½ç®¡è¿™ä¸ªé€šç”¨çš„å‡½æ•°è°ƒç”¨æ–¹æ¡ˆï¼Œè¢«æˆ‘ä»¬å¦å†³äº†ï¼Œä½†æ˜¯å¦‚æœè¢«è°ƒç”¨çš„å‡½æ•°é‡Œï¼Œæ²¡æœ‰è°ƒç”¨å…¶ä»–å‡½æ•°ï¼Œè¿™ä¸ªæ–¹æ³•è¿˜æ˜¯å¯ä»¥è¡Œå¾—é€šçš„ã€‚</p><p>äº‹å®ä¸Šï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå¸¸è§çš„ç¼–è¯‘å™¨è¿›è¡Œè‡ªåŠ¨ä¼˜åŒ–çš„åœºæ™¯ï¼Œæˆ‘ä»¬é€šå¸¸å«<strong>å‡½æ•°å†…è”</strong>ï¼ˆInlineï¼‰ã€‚æˆ‘ä»¬åªè¦åœ¨GCCç¼–è¯‘çš„æ—¶å€™ï¼ŒåŠ ä¸Šå¯¹åº”çš„ä¸€ä¸ªè®©ç¼–è¯‘å™¨è‡ªåŠ¨ä¼˜åŒ–çš„å‚æ•°-Oï¼Œç¼–è¯‘å™¨å°±ä¼šåœ¨å¯è¡Œçš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œè¿™æ ·çš„æŒ‡ä»¤æ›¿æ¢ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç ã€‚</p><pre><code>#include &lt;stdio.h&gt;
#include &lt;time.h&gt;
#include &lt;stdlib.h&gt;

int static add(int a, int b)
{
    return a+b;
}

int main()
{
    srand(time(NULL));
    int x = rand() % 5
    int y = rand() % 10;
    int u = add(x, y)
    printf(&quot;u = %d\n&quot;, u)
}
</code></pre><p>ä¸ºäº†é¿å…ç¼–è¯‘å™¨ä¼˜åŒ–æ‰å¤ªå¤šä»£ç ï¼Œæˆ‘å°å°ä¿®æ”¹äº†ä¸€ä¸‹function_example.cï¼Œè®©å‚æ•°xå’Œyéƒ½å˜æˆäº†ï¼Œé€šè¿‡éšæœºæ•°ç”Ÿæˆï¼Œå¹¶åœ¨ä»£ç çš„æœ€ååŠ ä¸Šå°†ué€šè¿‡printfæ‰“å°å‡ºæ¥çš„è¯­å¥ã€‚</p><pre><code>$ gcc -g -c -O function_example_inline.c
$ objdump -d -M intel -S function_example_inline.o
</code></pre><p>ä¸Šé¢çš„function_example_inline.cçš„ç¼–è¯‘å‡ºæ¥çš„æ±‡ç¼–ä»£ç ï¼Œæ²¡æœ‰æŠŠaddå‡½æ•°å•ç‹¬ç¼–è¯‘æˆä¸€æ®µæŒ‡ä»¤é¡ºåºï¼Œè€Œæ˜¯åœ¨è°ƒç”¨u = add(x, y)çš„æ—¶å€™ï¼Œç›´æ¥æ›¿æ¢æˆäº†ä¸€ä¸ªaddæŒ‡ä»¤ã€‚</p><pre><code>    return a+b;
  4c:   01 de                   add    esi,ebx
</code></pre><p>é™¤äº†ä¾é ç¼–è¯‘å™¨çš„è‡ªåŠ¨ä¼˜åŒ–ï¼Œä½ è¿˜å¯ä»¥åœ¨å®šä¹‰å‡½æ•°çš„åœ°æ–¹ï¼ŒåŠ ä¸Šinlineçš„å…³é”®å­—ï¼Œæ¥æç¤ºç¼–è¯‘å™¨å¯¹å‡½æ•°è¿›è¡Œå†…è”ã€‚</p><p>å†…è”å¸¦æ¥çš„ä¼˜åŒ–æ˜¯ï¼ŒCPUéœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤æ•°å˜å°‘äº†ï¼Œæ ¹æ®åœ°å€è·³è½¬çš„è¿‡ç¨‹ä¸éœ€è¦äº†ï¼Œå‹æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ä¹Ÿä¸ç”¨äº†ã€‚</p><p>ä¸è¿‡å†…è”å¹¶ä¸æ˜¯æ²¡æœ‰ä»£ä»·ï¼Œå†…è”æ„å‘³ç€ï¼Œæˆ‘ä»¬æŠŠå¯ä»¥å¤ç”¨çš„ç¨‹åºæŒ‡ä»¤åœ¨è°ƒç”¨å®ƒçš„åœ°æ–¹å®Œå…¨å±•å¼€äº†ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°åœ¨å¾ˆå¤šåœ°æ–¹éƒ½è¢«è°ƒç”¨äº†ï¼Œé‚£ä¹ˆå°±ä¼šå±•å¼€å¾ˆå¤šæ¬¡ï¼Œæ•´ä¸ªç¨‹åºå ç”¨çš„ç©ºé—´å°±ä¼šå˜å¤§äº†ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/dc/85/dca83475560147d4dd492ff283ae0c85.jpeg" alt=""></p><p>è¿™æ ·æ²¡æœ‰è°ƒç”¨å…¶ä»–å‡½æ•°ï¼Œåªä¼šè¢«è°ƒç”¨çš„å‡½æ•°ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸º<strong>å¶å­å‡½æ•°ï¼ˆæˆ–å¶å­è¿‡ç¨‹ï¼‰</strong>ã€‚</p><h2>æ€»ç»“å»¶ä¼¸</h2><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬è®²äº†ä¸€ä¸ªç¨‹åºçš„å‡½æ•°é—´è°ƒç”¨ï¼Œåœ¨CPUæŒ‡ä»¤å±‚é¢æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ã€‚å…¶ä¸­ä¸€å®šéœ€è¦ä½ ç‰¢è®°çš„ï¼Œå°±æ˜¯<strong>ç¨‹åºæ ˆ</strong>è¿™ä¸ªæ–°æ¦‚å¿µã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°é€šè¿‡å‹æ ˆå’Œå‡ºæ ˆæ“ä½œï¼Œä½¿å¾—ç¨‹åºåœ¨ä¸åŒçš„å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­è¿›è¡Œè½¬ç§»ã€‚è€Œå‡½æ•°å†…è”å’Œæ ˆæº¢å‡ºï¼Œä¸€ä¸ªæ˜¯æˆ‘ä»¬å¸¸å¸¸å¯ä»¥é€‰æ‹©çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯æˆ‘ä»¬ä¼šå¸¸é‡åˆ°çš„ç¨‹åºBugã€‚</p><p>é€šè¿‡åŠ å…¥äº†ç¨‹åºæ ˆï¼Œæˆ‘ä»¬ç›¸å½“äºåœ¨æŒ‡ä»¤è·³è½¬çš„è¿‡ç¨‹ç§ï¼ŒåŠ å…¥äº†ä¸€ä¸ªâ€œè®°å¿†â€çš„åŠŸèƒ½ï¼Œèƒ½åœ¨è·³è½¬å»è¿è¡Œæ–°çš„æŒ‡ä»¤ä¹‹åï¼Œå†å›åˆ°è·³å‡ºå»çš„ä½ç½®ï¼Œèƒ½å¤Ÿå®ç°æ›´åŠ ä¸°å¯Œå’Œçµæ´»çš„æŒ‡ä»¤æ‰§è¡Œæµç¨‹ã€‚è¿™ä¸ªä¹Ÿä¸ºæˆ‘ä»¬åœ¨ç¨‹åºå¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæä¾›äº†â€œå‡½æ•°â€è¿™æ ·ä¸€ä¸ªæŠ½è±¡ï¼Œä½¿å¾—æˆ‘ä»¬åœ¨è½¯ä»¶å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å¤ç”¨ä»£ç å’ŒæŒ‡ä»¤ï¼Œè€Œä¸æ˜¯åªèƒ½ç®€å•ç²—æš´åœ°å¤åˆ¶ã€ç²˜è´´ä»£ç å’ŒæŒ‡ä»¤ã€‚</p><h2>æ¨èé˜…è¯»</h2><p>å¦‚æœä½ è§‰å¾—è¿˜ä¸è¿‡ç˜¾ï¼Œå¯ä»¥ä»”ç»†è¯»ä¸€ä¸‹ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿï¼ˆç¬¬ä¸‰ç‰ˆï¼‰ã€‹çš„3.7å°èŠ‚ã€Šè¿‡ç¨‹ã€‹ï¼Œè¿›ä¸€æ­¥äº†è§£å‡½æ•°è°ƒç”¨æ˜¯æ€ä¹ˆå›äº‹ã€‚</p><p>å¦å¤–ï¼Œæˆ‘æ¨èä½ èŠ±ä¸€ç‚¹æ—¶é—´ï¼Œé€šè¿‡æœç´¢å¼•æ“ææ¸…æ¥šfunction_example.cæ¯ä¸€è¡Œæ±‡ç¼–ä»£ç çš„å«ä¹‰ï¼Œè¿™ä¸ªèƒ½å¤Ÿå¸®ä½ è¿›ä¸€æ­¥æ·±å…¥äº†è§£ç¨‹åºæ ˆã€æ ˆå¸§ã€å¯„å­˜å™¨ä»¥åŠIntel CPUçš„æŒ‡ä»¤é›†ã€‚</p><h2>è¯¾åæ€è€ƒ</h2><p>åœ¨ç¨‹åºæ ˆé‡Œé¢ï¼Œé™¤äº†æˆ‘ä»¬è·³è½¬å‰çš„æŒ‡ä»¤åœ°å€å¤–ï¼Œè¿˜éœ€è¦ä¿ç•™å“ªäº›ä¿¡æ¯ï¼Œæ‰èƒ½åœ¨æˆ‘ä»¬åœ¨å‡½æ•°è°ƒç”¨å®Œæˆä¹‹åï¼Œè·³è½¬å›åˆ°æŒ‡ä»¤åœ°å€çš„æ—¶å€™ï¼Œç»§ç»­æ‰§è¡Œå®Œå‡½æ•°è°ƒç”¨ä¹‹åçš„æŒ‡ä»¤å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æƒ³ä¸€æƒ³ï¼ŒæŸ¥ä¸€æŸ¥ï¼Œç„¶ååœ¨ç•™è¨€åŒºç•™ä¸‹ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™ä½ çš„æœ‹å‹ï¼Œå’Œä»–ä¸€èµ·æ€è€ƒå’Œè¿›æ­¥ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/28/29/281ca28b90c8aa0aecbb5adc08394f29.jpg" alt=""></p> </div> </div> <div data-v-87ffcada="" class="article-comments"><h2 data-v-87ffcada=""><span data-v-87ffcada="">ç²¾é€‰ç•™è¨€</span></h2> <ul data-v-87ffcada="">  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/ed/f8/b6aad044.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">CGer_AJ</span> </div> <div class="bd">è¿™ä¸ªå¾ˆå¥½ è®²çš„å¾ˆç»† è¿™ä¸¤ç« æˆ‘è¦åå¤çœ‹ å¹¶æ‰‹åŠ¨å®è·µ æ„Ÿè§‰ä½œè€… æŠŠè¿™ä¸ªè¯¾è®²çš„ç”ŸåŠ¨å½¢è±¡~è¿™ä¸ªç»å¯¹æ˜¯æœ€å€¼çš„è¯¾ç¨‹<br></div> <span class="time">2019-05-09</span>  </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/50/4a/04fef27f.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">kdb_reboot</span> </div> <div class="bd">å€’æ•°ç¬¬äºŒå›¾æ¯”è¾ƒå¥½ <br>è¡¥å……ä¸€ä¸‹å¯„å­˜å™¨è¯´æ˜<br>rbp - register base pointer (start of stack)<br>rsp - register stack pointer (current location in stack, growing downwards)<br>å»ºè®®å°†å›¾ç¼–å·è¿™æ ·è¯„è®ºçš„æ—¶å€™ä¹Ÿèƒ½æœ‰æ‰€æŒ‡ä»£<br></div> <span class="time">2019-05-10</span> <div class="reply"> <div class="reply-hd"><span>ä½œè€…å›å¤</span></div> <p class="reply-content">kdb_rebootï¼Œè°¢è°¢å»ºè®®ã€‚è¿™ä¸ªå»ºè®®ä¸é”™ï¼Œæˆ‘éº»çƒ¦ç¼–è¾‘ç¨ååŠ ä¸Šã€‚</p> <p class="reply-time">2019-05-10</p> </div> </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/a6/43/cb6ab349.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">Spring</span> </div> <div class="bd">callä¹‹åï¼ŒåŸå‡½æ•°çš„bpå°±ä¼šèµ‹å€¼ä¸ºspï¼Œå› æ­¤åªè¦æŠŠbpå‹æ ˆå°±å¥½äº†ï¼Œcallä¹‹åå†æŠŠä¹‹å‰å‹æ ˆçš„bpå‡ºæ ˆèµ‹å€¼ç»™spå°±å¥½äº†ã€‚<br>å‡½æ•°è¿”å›åä¼šæŠŠè¿”å›å€¼æ”¾åˆ°axå¯„å­˜å™¨ï¼Œå¦‚æœæœ‰å¤šä¸ªè¿”å›å€¼çš„è¯å°±å°†è¿”å›å€¼çš„å†…å­˜åœ°å€æ”¾åˆ°axä¸­ã€‚<br>å› æ­¤callä¹‹åæ¢å¤å›åŸå‡½æ•°è¿˜è¦ä¿å­˜bpå’Œè¿”å›å€¼ã€‚<br></div> <span class="time">2019-05-10</span> <div class="reply"> <div class="reply-hd"><span>ä½œè€…å›å¤</span></div> <p class="reply-content">è¿˜éœ€è¦è€ƒè™‘å‡½æ•°çš„è°ƒç”¨å‚æ•°ä¼ é€’å“¦ã€‚</p> <p class="reply-time">2019-05-10</p> </div> </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/16/25/7f/473d5a77.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">æ›¾è½¼éºŸ</span> </div> <div class="bd">çœ‹äº†å‰é¢è¿™å‡ ç¯‡æ–‡ç« ï¼Œæ„Ÿè§‰ä¸“æ æœ‰ç‚¹å€¾å‘æ“ä½œç³»ç»ŸåŸç†æ›´å¤šä¸€äº›<br></div> <span class="time">2019-05-10</span> <div class="reply"> <div class="reply-hd"><span>ä½œè€…å›å¤</span></div> <p class="reply-content">ç»„æˆæ˜¯ä¸€é—¨ç‰µæ¶‰åˆ°æ“ä½œç³»ç»Ÿã€ç¼–è¯‘ã€æ•°å­—ç”µè·¯ç­‰å¾ˆå¤šæ ¸å¿ƒè¯¾ç¨‹çš„å†…å®¹ã€‚ç¨‹åºåŠ è½½å’Œé“¾æ¥éƒ¨åˆ†çš„ç¡®å’Œæ“ä½œç³»ç»Ÿå’Œç¼–è¯‘åŸç†è„±ä¸å¼€å…³ç³»ï¼Œä½†æ˜¯æƒ³è¦æ·±å…¥ç†è§£æ“ä½œç³»ç»Ÿï¼Œè¿˜æ˜¯è¦ä¸“é—¨ä¸Šä¸€é—¨æ“ä½œç³»ç»Ÿçš„è¯¾ã€‚</p> <p class="reply-time">2019-05-10</p> </div> </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/4d/79/7b6eb74f.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">zlw</span> </div> <div class="bd">retæ¥ç€å‡ºæ ˆåçš„æ ˆé¡¶ç»§ç»­æ‰§è¡Œï¼Œæ˜¯rbpè¿˜æ˜¯rsp?rspå§‹ç»ˆæŒ‡å‘æ ˆé¡¶æ€ä¹ˆåšåˆ°çš„?<br></div> <span class="time">2019-05-10</span> <div class="reply"> <div class="reply-hd"><span>ä½œè€…å›å¤</span></div> <p class="reply-content">å…¶å®æ˜¯åœ¨callçš„æ—¶å€™ä¼šå¯¹PCå¯„å­˜å™¨è¿›è¡Œå‹æ ˆï¼Œåšäº†ä¸€ä¸ªpush eip çš„æ“ä½œï¼Œè€Œåœ¨retçš„æ—¶å€™åšäº†pop eipçš„æ“ä½œã€‚</p> <p class="reply-time">2019-05-10</p> </div> </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/23/66/413c0bb5.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">LDxy</span> </div> <div class="bd">åœ¨ç¨‹åºæ ˆé‡Œé¢ï¼Œé™¤äº†æˆ‘ä»¬è·³è½¬å‰çš„æŒ‡ä»¤åœ°å€å¤–ï¼Œè¿˜éœ€è¦ä¿ç•™CPUé€šç”¨å¯„å­˜å™¨çš„ä¸­çš„æ•°æ®<br></div> <span class="time">2019-05-10</span>  </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">Linuxer</span> </div> <div class="bd">0x0000000000400508 &lt;+0&gt;:     push   %rbp<br>0x0000000000400509 &lt;+1&gt;:     mov    %rsp,%rbp<br>0x000000000040050c &lt;+4&gt;:     sub    $0x18,%rsp<br>0x0000000000400510 &lt;+8&gt;:     movl   $0x1,-0x4(%rbp)<br>0x0000000000400517 &lt;+15&gt;:    movl   $0x2,-0x8(%rbp)<br>0x000000000040051e &lt;+22&gt;:    mov    -0x8(%rbp),%esi<br>0x0000000000400521 &lt;+25&gt;:    mov    -0x4(%rbp),%eax<br>0x0000000000400524 &lt;+28&gt;:    movl   $0x7,(%rsp)<br>=&gt; 0x000000000040052b &lt;+35&gt;:    mov    $0x6,%r9d<br> 0x0000000000400531 &lt;+41&gt;:    mov    $0x5,%r8d<br> 0x0000000000400537 &lt;+47&gt;:    mov    $0x4,%ecx<br> 0x000000000040053c &lt;+52&gt;:    mov    $0x3,%edx<br> 0x0000000000400541 &lt;+57&gt;:    mov    %eax,%edi<br> 0x0000000000400543 &lt;+59&gt;:    callq  0x4004cd &lt;add&gt;<br> 0x0000000000400548 &lt;+64&gt;:    mov    %eax,-0xc(%rbp)<br> 0x000000000040054b &lt;+67&gt;:    mov    $0x0,%eax<br> 0x0000000000400550 &lt;+72&gt;:    leaveq<br> 0x0000000000400551 &lt;+73&gt;:    retq<br>(gdb) i r<br>rcx            0x400560 4195680<br>rdx            0x7fffffffe4e8   140737488348392<br>rbp            0x7fffffffe3f0   0x7fffffffe3f0<br>rsp            0x7fffffffe3d8   0x7fffffffe3d8<br>r12            0x4003e0 4195296<br>r13            0x7fffffffe4d0   140737488348368<br>r14            0x0      0<br>r15            0x0      0<br>rip            0x40052b 0x40052b &lt;main+35&gt;<br>eflags         0x216    [ PF AF IF ]<br>cs             0x33     51<br>ss             0x2b     43<br>ds             0x0      0<br>es             0x0      0<br>fs             0x0      0<br>gs             0x0      0<br>(gdb) x&#47;24x $rbp<br>0x7fffffffe3f0: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00<br>0x7fffffffe3f8: 0xd5    0x03    0xa3    0xf7    0xff    0x7f    0x00    0x00<br>0x7fffffffe400: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00<br>(gdb) x&#47;24x ($rbp-24)<br>0x7fffffffe3d8: 0x07    0x00    0x00    0x00    0x00    0x00    0x00    0x00<br>0x7fffffffe3e0: 0xd0    0xe4    0xff    0xff    0xff    0x7f    0x00    0x00<br>0x7fffffffe3e8: 0x02    0x00    0x00    0x00    0x01    0x00    0x00    0x00<br>ä»gdbçš„ç»“æœæ¥çœ‹ï¼Œä¿å­˜äº†å±€éƒ¨å˜é‡ è°ƒç”¨å‡½æ•°çš„å‚æ•°ï¼Œä½†æ˜¯è¿™é‡Œä¸ç†è§£çš„æ˜¯æˆ‘çš„mainæ–¹æ³•é‡Œé¢åªå®šä¹‰äº†ä¸‰ä¸ªå±€éƒ¨å˜é‡ï¼Œä¸ºä»€ä¹ˆè¦åˆ†é…24å­—èŠ‚å‘¢ï¼Ÿ åŠ ä¸Šä¼ å‚çš„4å­—èŠ‚åº”è¯¥16å­—èŠ‚ä¹Ÿå¤Ÿäº†<br></div> <span class="time">2019-05-10</span>  </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/13/9d/d91dc762.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">å–œæ¬¢åƒé±¼</span> </div> <div class="bd">å¾è€å¸ˆï¼Œé—®æ‚¨ä¸€ä¸ªå’Œè¿™èŠ‚å†…å®¹ä¸æ˜¯å¾ˆç›¸å…³çš„ä¸€ä¸ªé—®é¢˜å¯ä»¥å—ï¼Ÿ<br>ä¸ºä»€ä¹ˆåœ¨å†™å¤šé‡forå¾ªç¯çš„æ—¶å€™ï¼Œå¾ªç¯æ¬¡æ•°å¤šçš„å¤§å¾ªç¯è¦å†™é‡Œé¢ï¼Œå°å¾ªç¯å†™å¤–é¢ï¼Ÿ<br>å¸Œæœ›è€å¸ˆè§£ç­”ä¸‹ï¼Œéå¸¸æ„Ÿè°¢ï¼ï¼ï¼<br></div> <span class="time">2019-05-10</span>  </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">Linuxer</span> </div> <div class="bd">é—®ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘çœ‹è€å¸ˆobjdump -M intel è¿™é‡Œ-Mçš„å‚æ•° intelæ˜¯æ ¹æ®ä»€ä¹ˆè§„åˆ™å»é€‰çš„å‘¢ï¼Ÿ æˆ‘çœ‹è¿‡man objdumpè¿˜æ˜¯ä¸çŸ¥é“æ€ä¹ˆæŒ‡å®š<br></div> <span class="time">2019-05-10</span>  </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/ec/2a/b11d5ad8.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">æ›¾ç»ç˜¦è¿‡</span> </div> <div class="bd">è®²å¾—å¾ˆå¥½å¾ˆç”ŸåŠ¨  åŸºæœ¬éƒ½æ‡‚äº† è¿˜éœ€è¦åå¤é˜…è¯» åŠ æ·±å°è±¡  åœ¨è¯»ä¸€è¯»ä¹¦   åŠ æ·±å°è±¡<br></div> <span class="time">2019-05-10</span>  </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/41/87/cc6d5451.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">Better me</span> </div> <div class="bd">push rbpï¼›<br>mov rbp rspï¼›<br>è€å¸ˆï¼Œæƒ³é—®è¿™ä¸¤å¥æ˜¯å¦‚ä½•æ§åˆ¶å‡½æ•°è°ƒç”¨çš„<br></div> <span class="time">2019-05-10</span>  </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/58/79/e7bbd28e.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">ä¸ç³»ä¹‹èˆŸ</span> </div> <div class="bd">æ–‡ç« ä¸­çš„&quot;push rbp å°±æŠŠä¹‹å‰è°ƒç”¨å‡½æ•°çš„è¿”å›åœ°å€ï¼Œå‹åˆ°æ ˆé¡¶ã€‚&quot;<br><br>æ„Ÿè§‰è¿™å¥è¯æœ‰é—®é¢˜ï¼Œå‡½æ•°çš„è¿”å›åœ°å€å‹åˆ°æ ˆé¡¶ï¼Œåº”è¯¥æ˜¯callæŒ‡ä»¤åšçš„ã€‚<br></div> <span class="time">2019-05-10</span>  </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/9b/ec/f16470a0.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">ä¸Šäº”æ¥¼çš„å¿«æ´»</span> </div> <div class="bd">è€å¸ˆæ‚¨å¥½ï¼Œåˆšè®¢é˜…ï¼Œåœ¨å“ªå„¿åŠ å­¦ä¹ å°ç»„<br></div> <span class="time">2019-05-10</span> <div class="reply"> <div class="reply-hd"><span>ä½œè€…å›å¤</span></div> <p class="reply-content">ç•™è¨€åŒºå°±æ˜¯å¤§å®¶çš„å­¦ä¹ å°ç»„ã€‚</p> <p class="reply-time">2019-05-10</p> </div> </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/13/9d/d91dc762.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">å–œæ¬¢åƒé±¼</span> </div> <div class="bd">è€å¸ˆï¼Œä¸ºä»€ä¹ˆæˆ‘æŠŠaddå‡½æ•°å˜ä¸ºinlineå‡½æ•°ä¹‹åï¼Œobjdumpå‡ºæ¥çš„è°ƒç”¨addå¤„çš„æ±‡ç¼–æŒ‡ä»¤è¿˜æ˜¯ï¼šcall   25 &lt;main+0x25&gt;<br><br></div> <span class="time">2019-05-10</span> <div class="reply"> <div class="reply-hd"><span>ä½œè€…å›å¤</span></div> <p class="reply-content">æˆ‘æ¨æµ‹æ˜¯ä¸æ˜¯ä½ åœ¨è°ƒç”¨gccçš„æ—¶å€™ï¼Œæ²¡æœ‰å¼€å¯ -O å‚æ•°æ¥å¼€å¯ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Ÿ<br>gcc -g -c -O function_example_inline.c</p> <p class="reply-time">2019-05-10</p> </div> </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/41/87/cc6d5451.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">Better me</span> </div> <div class="bd">rbpã€rspæ˜¯å¦‚ä½•ç®¡ç†å‡½æ•°ä¹‹é—´çš„è°ƒç”¨çš„<br></div> <span class="time">2019-05-10</span> <div class="reply"> <div class="reply-hd"><span>ä½œè€…å›å¤</span></div> <p class="reply-content">Better meï¼ŒæŠ±æ­‰ï¼Œæˆ‘æ²¡å¤ªç†è§£ï¼Œè¿™æ˜¯ä¸€ä¸ªæé—®ä¹ˆï¼Ÿ</p> <p class="reply-time">2019-05-10</p> </div> </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/bf/aa/abb7bfe3.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">å…è´¹çš„äºº</span> </div> <div class="bd">æ€è€ƒé¢˜ï¼šå‡½æ•°è¿”å›å€¼ã€è¿”å›åœ°å€ã€sp bp<br></div> <span class="time">2019-05-10</span> <div class="reply"> <div class="reply-hd"><span>ä½œè€…å›å¤</span></div> <p class="reply-content">ç­”æ¡ˆä¸å¤ªå¯¹å“¦ï¼Œé™¤äº†è¿”å›åœ°å€ä¹‹å¤–ï¼Œè¿™äº›éƒ½æ˜¯ä¸ç”¨åœ¨è°ƒç”¨å‰å•ç‹¬å‹æ ˆçš„ï¼Œå¯ä»¥å†æœç´¢çœ‹çœ‹å…¶ä»–èµ„æ–™å†æ¥å›ç­”è¿™ä¸ªé—®é¢˜ã€‚</p> <p class="reply-time">2019-05-10</p> </div> </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/4f/60/049a20e9.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">å´å®‡æ™¨</span> </div> <div class="bd">æˆ‘è®°å¾—åº”è¯¥è¿˜è¦ä¿å­˜è°ƒç”¨æ–¹çš„æ ˆåœ°å€ï¼Œè°ƒç”¨ç»“æŸæ‰èƒ½è¿˜åŸæ ˆï¼Œcsappä¹‹å‰çœ‹äº†ï¼Œä½†æ˜¯å¹³å¸¸æ¥è§¦ä¸åˆ°è¿™äº›çŸ¥è¯†ï¼Œéƒ½å¿˜çš„å·®ä¸å¤šäº†ğŸ˜…ğŸ˜…<br></div> <span class="time">2019-05-10</span> <div class="reply"> <div class="reply-hd"><span>ä½œè€…å›å¤</span></div> <p class="reply-content">å´å®‡æ™¨åŒå­¦ä½ å¥½ï¼Œè°ƒç”¨æ–¹çš„æ ˆåœ°å€æ˜¯åœ¨ä»–è‡ªå·±è¢«è°ƒç”¨çš„æ—¶å€™å·²ç»å‹æ ˆäº†å‘€ï¼Œå¯ä»¥å†å›å¤´å»çœ‹ä¸€ä¸‹csappã€‚</p> <p class="reply-time">2019-05-10</p> </div> </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/59/f6/ed66d1c1.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">chengzise</span> </div> <div class="bd">è€å¸ˆè¿™é‡Œéœ€è¦è¡¥å†²ä¸€ä¸‹ï¼Œå‡½æ•°è°ƒç”¨callæŒ‡ä»¤æ—¶ï¼Œï¼ˆPCï¼‰æŒ‡ä»¤åœ°å€å¯„å­˜å™¨ä¼šè‡ªåŠ¨å‹æ ˆï¼Œå³è¿”å›åœ°å€å‹æ ˆï¼Œå‡½æ•°è¿”å›retæŒ‡ä»¤æ—¶ä¼šè‡ªåŠ¨å¼¹æ ˆï¼Œå³è¿”å›åœ°å€èµ‹å€¼ç»™PCå¯„å­˜å™¨ï¼ŒæŠŠä¹‹å‰ã€‚å›¾ç‰‡æœ‰æ˜¾ç¤ºå‹æ ˆï¼Œæ²¡æœ‰æ–‡å­—è¯´æ˜ï¼Œå…¶ä»–åŒå­¦å¯ä»¥ä¸å¤ªç†è§£ã€‚<br></div> <span class="time">2019-05-10</span> <div class="reply"> <div class="reply-hd"><span>ä½œè€…å›å¤</span></div> <p class="reply-content">ğŸ‘ï¼Œè°¢è°¢ chengzise åŒå­¦ï¼Œè°¢è°¢è¡¥å……ã€‚call åœ¨è°ƒç”¨çš„æ—¶å€™ä¼šåšpush eipçš„æ“ä½œï¼Œè€Œåœ¨retçš„æ—¶å€™ä¼šåšpop eipçš„æ“ä½œã€‚</p> <p class="reply-time">2019-05-10</p> </div> </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/69/4d/81c44f45.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">æ‹‰æ¬§</span> </div> <div class="bd">Push rbp, move rpb rsp,ä»¥å‰ä¸€ç›´ä¸çŸ¥é“è¿™ä¸¤å¥çš„å«ä¹‰ï¼Œç°åœ¨æ¸…æ¥šäº†<br></div> <span class="time">2019-05-10</span> <div class="reply"> <div class="reply-hd"><span>ä½œè€…å›å¤</span></div> <p class="reply-content">ğŸ‘</p> <p class="reply-time">2019-05-10</p> </div> </div> </li>  <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/e9/57/68e414ba.jpg" class="avatar"> <div class="info"> <div class="hd"><span class="username">@æˆ‘</span> </div> <div class="bd">è¿˜è¦ä¿æŠ¤ç°åœºï¼Œä¿æŠ¤ç°åœºçš„å˜é‡å€¼ä¹Ÿæ˜¯å­˜åˆ°ç³»ç»Ÿæ ˆé‡Œé¢çš„ï¼Ÿå¤šçº¿ç¨‹åˆ‡æ¢çš„è¯ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿè¦å­˜åˆ°è‡ªå·±çº¿ç¨‹å¯¹åº”çš„æ ˆé‡Œé¢ï¼Ÿ<br></div> <span class="time">2019-05-10</span> <div class="reply"> <div class="reply-hd"><span>ä½œè€…å›å¤</span></div> <p class="reply-content">æ˜¯å­˜åˆ°å¯„å­˜å™¨æˆ–è€…æ ˆé‡Œé¢çš„ï¼Œå¦‚æœå¯„å­˜å™¨é‡Œé¢å­˜ä¸ä¸‹ï¼Œå°±ä¼šæ”¾åˆ°æ ˆå¸§é‡Œé¢å»ã€‚<br><br>å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„æ ˆã€‚ä½†æ˜¯çº¿ç¨‹åˆ‡æ¢æ˜¯context switchï¼Œè¿™ä¸ªå’Œå‡½æ•°è°ƒç”¨å¹¶ä¸ç›¸åŒã€‚context switché€šå¸¸è¦è§£å†³çš„æ˜¯æŠŠå½“å‰ç°åœºä¸­çš„å…¶ä»–ä¿¡æ¯ä¿ç•™ä¸‹æ¥ï¼Œæ¯”å¦‚å¯„å­˜å™¨é‡Œé¢çš„å†…å®¹ç­‰ç­‰ï¼Œè€Œä¸æ˜¯åšä¸€æ¬¡å‹æ ˆã€‚</p> <p class="reply-time">2019-05-10</p> </div> </div> </li>  </ul> </div> </div> </div> </div> </div> </body> </html>
